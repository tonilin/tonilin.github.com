<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Rails | 蟑螂窩]]></title>
  <link href="http://blog.roachking.net/blog/categories/rails/atom.xml" rel="self"/>
  <link href="http://blog.roachking.net/"/>
  <updated>2014-04-12T21:38:37+08:00</updated>
  <id>http://blog.roachking.net/</id>
  <author>
    <name><![CDATA[tonilin]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails 4.1.0 Invalid Locale 問題]]></title>
    <link href="http://blog.roachking.net/blog/2014/04/12/rails-4-1-0-invalid-locacle/"/>
    <updated>2014-04-12T21:00:00+08:00</updated>
    <id>http://blog.roachking.net/blog/2014/04/12/rails-4-1-0-invalid-locacle</id>
    <content type="html"><![CDATA[<p>最近 Rails 4.1.0 release，在升級的時候發生了一個錯誤:</p>

<p><code>bash
:zh is not a valid locale
</code></p>

<p>application.rb 的 code 佷簡單：</p>

<p>```ruby
module Demo
  class Application &lt; Rails::Application</p>

<pre><code>config.i18n.default_locale = :"zh-TW"
</code></pre>

<p>  end
end
```</p>

<p>以前不會出錯，為什麼現在會呢？於是 Google 了一下，發現 Rails 4.1.0 會將 <code>I18n.config.enforce_available_locales</code> 預設為 <code>true</code></p>

<p>在 <code>enforce_available_locales</code> 為 <code>true</code> 的情況下，只要將 <code>locale</code> 設為不包含在 <code>available_locales</code> 內的值，就會報錯。</p>

<p>解法佷簡單就直接在 <code>application.rb</code> 裡面把 enforce_available_locales 改為 false：</p>

<p>```ruby
module Demo
  class Application &lt; Rails::Application</p>

<pre><code>config.i18n.enforce_available_locales = false
config.i18n.default_locale = :"zh-TW"
</code></pre>

<p>  end
end
```</p>

<p>如果想用 enforce_available_locales 但又不希望報錯呢？試著加入 available_locales 看看：</p>

<p>```ruby
module Demo
  class Application &lt; Rails::Application</p>

<pre><code>config.i18n.available_locales = [:"zh-TW"]
config.i18n.default_locale = :"zh-TW"
</code></pre>

<p>  end
end
```</p>

<p>依然還是會出現一樣的錯誤 <code>:zh is not a valid locale</code>，奇怪，我設定的是 <code>:"zh-TW"</code>，怎麼會報 <code>:zh</code> 不允許呢？
找了很久，發現在 <code>production.rb</code> 裡面有一行 i18n fallback：</p>

<p><code>ruby
  # Enable locale fallbacks for I18n (makes lookups for any locale fall back to
  # the I18n.default_locale when a translation can not be found).
  config.i18n.fallbacks = true
</code></p>

<p>把 i18n fallbacks 設為 <code>true</code>，在找不到 <code>:"zh-TW"</code> 的 locale 的時候，會接著尋找 <code>:zh</code>，<code>:zh</code> 找不到才會接著找 <code>:en</code>。</p>

<p>於是解決方法就很清楚了，只要連 <code>:zh</code> 一起 available 就可以了：</p>

<p>```ruby
module Demo
  class Application &lt; Rails::Application</p>

<pre><code>config.i18n.available_locales = [:"zh-TW", :zh]
config.i18n.default_locale = :"zh-TW"
</code></pre>

<p>  end
end
```</p>
]]></content>
  </entry>
  
</feed>
